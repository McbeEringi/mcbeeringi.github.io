<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<script async src="https://mcbeeringi.github.io/src/gas.js"></script>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>McbeEringi graph</title>
	<meta name="description" content="Google Forms graph parse">
	<link rel="icon" type="image/svg+xml" href="../img/icon.svg">
	<link rel="apple-touch-icon" href="../img/icon.png">
	<meta name="theme-color" content="#214"/>

	<link rel="stylesheet" href="../src/style.css">
</head>
<body>
	<style>textarea{width:100%;}</style>
	<h1>graph</h1>
	<hr>
	<label>svg:<input id="inp" class="zab"></label>
	<div id="out"></div>
	<script>
		const
			e=document.createElement('div'),
			aaa=class{
				constructor(w){
					this.e=document.createElement('div');
					this.e.innerHTML=w;
					this.label=[...this.e.querySelectorAll('text:not([aria-hidden])')].reduce((a,x,i)=>(i={start:'contents',middle:'category',end:'num'}[x.getAttribute('text-anchor')],a[i]||(a[i]=[]),a[i].push(x),a),{})
					this.y1=(x=>x[0].getAttribute('y')-x[1].getAttribute('y'))(this.e.querySelector('g[clip-path]>g:nth-of-type(1)').children)/+this.label.num[1].textContent;
					this.cfg={};
				}
				bars(){return[...this.e.querySelector('g[clip-path]>g:nth-of-type(2)').children].reduce((a,x,i)=>(a[i%this.label.category.length][i/this.label.category.length|0]=Math.round(+x.getAttribute('height')/this.y1),a),[...Array(this.label.category.length)].map(_=>[]));}
				graph(){
					this.bars().reduce((a,x,i)=>(
						a.a.push(x.reduce((b,y,j)=>(b.x+=y/b.h,b),{x:0,a:[],h:x.reduce((c,z)=>c+z,0)}).a),
						a
					),{
						_(){
							this.a=this.a.map(x=>`<path d="${x.d}" style="${x.style}"/>`);
							return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">${this.a.join('')}</svg>`;
						}
					})._();
				}
			}
		inp.value=`<svg width="720" height="250" style="overflow: hidden;" aria-label="グラフです。"><defs id="_ABSTRACT_RENDERER_ID_47"><clipPath id="_ABSTRACT_RENDERER_ID_48"><rect x="50" y="13" width="670" height="188"></rect></clipPath><filter id="_ABSTRACT_RENDERER_ID_51"><feGaussianBlur in="SourceAlpha" stdDeviation="2"></feGaussianBlur><feOffset dx="1" dy="1"></feOffset><feComponentTransfer><feFuncA type="linear" slope="0.1"></feFuncA></feComponentTransfer><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs><rect x="0" y="0" width="720" height="250" stroke="none" stroke-width="0" fill="#ffffff"></rect><g><rect x="50" y="13" width="670" height="188" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g clip-path="url(https://docs.google.com/forms/d/1jsYj1sFIWkA0J6k9bsseh0f1ZR125w0Ujww5Ea0WZ7o/edit?pli=1#_ABSTRACT_RENDERER_ID_48)"><g><rect x="50" y="200" width="670" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="50" y="153" width="670" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="50" y="107" width="670" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="50" y="60" width="670" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="50" y="13" width="670" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="50" y="177" width="670" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="50" y="130" width="670" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="50" y="83" width="670" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="50" y="36" width="670" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect></g><g><rect x="82" y="33" width="20" height="167" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="250" y="145" width="20" height="55" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="417" y="42" width="20" height="158" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="584" y="173" width="20" height="27" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="103" y="42" width="20" height="158" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="271" y="173" width="19" height="27" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="438" y="33" width="20" height="167" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="605" y="200" width="20" height="0.5" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="124" y="126" width="20" height="74" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="291" y="173" width="20" height="27" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="459" y="145" width="20" height="55" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="626" y="200" width="20" height="0.5" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="145" y="192" width="20" height="8" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="312" y="79" width="20" height="121" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="480" y="182" width="19" height="18" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="647" y="42" width="20" height="158" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="166" y="192" width="20" height="8" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="333" y="200" width="20" height="0.5" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="500" y="182" width="20" height="18" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="668" y="192" width="20" height="8" stroke="none" stroke-width="0" fill="#990099"></rect></g><g><rect x="50" y="200" width="670" height="1" stroke="none" stroke-width="0" fill="#333333"></rect></g></g><g></g><g><g><text text-anchor="middle" x="134.125" y="218.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">ライティング</text></g><g><text text-anchor="middle" x="301.375" y="218.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">スピーキング</text></g><g><text text-anchor="middle" x="468.625" y="218.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">リーディング</text></g><g><text text-anchor="middle" x="635.875" y="218.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">リスニング</text></g><g><text text-anchor="end" x="38" y="204.7" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#444444">0</text></g><g><text text-anchor="end" x="38" y="157.95" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#444444">5</text></g><g><text text-anchor="end" x="38" y="111.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#444444">10</text></g><g><text text-anchor="end" x="38" y="64.45" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#444444">15</text></g><g><text text-anchor="end" x="38" y="17.7" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#444444">20</text></g></g><g><rect x="50" y="20" width="497" height="12" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><rect x="50" y="20" width="90" height="12" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><g><text text-anchor="start" x="79" y="30.2" font-family="Arial" font-size="12" stroke="#ffffff" stroke-width="3" fill="#222222" aria-hidden="true">Google翻訳</text><text text-anchor="start" x="79" y="30.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">Google翻訳</text></g></g><rect x="50" y="20" width="24" height="12" stroke="#ffffff" stroke-width="1" fill="#3366cc"></rect></g><g><rect x="159" y="20" width="63" height="12" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><g><text text-anchor="start" x="188" y="30.2" font-family="Arial" font-size="12" stroke="#ffffff" stroke-width="3" fill="#222222" aria-hidden="true">DeepL</text><text text-anchor="start" x="188" y="30.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">DeepL</text></g></g><rect x="159" y="20" width="24" height="12" stroke="#ffffff" stroke-width="1" fill="#dc3912"></rect></g><g><rect x="241" y="20" width="78" height="12" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><g><text text-anchor="start" x="270" y="30.2" font-family="Arial" font-size="12" stroke="#ffffff" stroke-width="3" fill="#222222" aria-hidden="true">ChatGPT</text><text text-anchor="start" x="270" y="30.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">ChatGPT</text></g></g><rect x="241" y="20" width="24" height="12" stroke="#ffffff" stroke-width="1" fill="#ff9900"></rect></g><g><rect x="338" y="20" width="125" height="12" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><g><text text-anchor="start" x="367" y="30.2" font-family="Arial" font-size="12" stroke="#ffffff" stroke-width="3" fill="#222222" aria-hidden="true">使ったことがない</text><text text-anchor="start" x="367" y="30.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">使ったことがない</text></g></g><rect x="338" y="20" width="24" height="12" stroke="#ffffff" stroke-width="1" fill="#109618"></rect></g><g><rect x="482" y="20" width="65" height="12" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><g><text text-anchor="start" x="511" y="30.2" font-family="Arial" font-size="12" stroke="#ffffff" stroke-width="3" fill="#222222" aria-hidden="true">その他</text><text text-anchor="start" x="511" y="30.2" font-family="Arial" font-size="12" stroke="none" stroke-width="0" fill="#222222">その他</text></g></g><rect x="482" y="20" width="24" height="12" stroke="#ffffff" stroke-width="1" fill="#990099"></rect></g></g></g><g></g></svg>`;
		(inp.oninput=w=>(
			out.innerHTML=new aaa(inp.value).graph()
		))()
</script>
</body>
</html>
